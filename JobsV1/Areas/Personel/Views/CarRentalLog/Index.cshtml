@model IEnumerable<JobsV1.Areas.Personel.Models.crLogTrip>

@{
    ViewBag.Title = "Trip Log";
    Layout = "~/Views/Shared/_ModuleLayout.cshtml";
}

<h2>Trip Log</h2>

<p>
    @Html.ActionLink("Add New Trip", "Create") |
    @Html.ActionLink("Copy Trip", "CopyTrip") |
    @Html.ActionLink("Cash Advance", "Index", "CarRentalCashRelease")
</p>

<div class="row" style="margin-bottom:5px;padding:10px;">
    <form>
        <p style="padding-left:10px;">
            <label>Date options: </label>
            <a class="cursor-pointer" onclick="SetStartDate(-7)"> This Week </a> |
            <a class="cursor-pointer" onclick="SetStartDate(-15)"> Last 15 Days </a> |
            <a class="cursor-pointer" onclick="SetStartDate(-30)"> Last 30 Days </a> 
        </p>
    </form>
    <form class="form-inline">
        @using (Html.BeginForm())
        {
            <span></span>
            <div class="form-group" style="padding-right:5px;">
                <label for="filter-date-label"> Date: </label>
                <input type="text" name="startDate" id="filter-sdate" class="form-control" style="width:120px;" />
                <label for="filter-date-label"> - </label>
                <input type="text" name="endDate" id="filter-edate" class="form-control" style="width:120px;" />
            </div>


            <div class="form-group" style="padding-right:5px;">
                <label for="filter-unit">Unit:</label>
                <select name="unit" id="filter-unit" class="form-control" >
                    <option value="all">All</option>
                    @foreach (var unit in ViewBag.crLogUnitList as List<JobsV1.Areas.Personel.Models.crLogUnit>)
                    {
                        <option value="@unit.Description"> @unit.Description </option>
                    }
                </select>
            </div>

            <div class="form-group" style="padding-right:5px;">
                <label for="filter-driver">Driver:</label>
                <select name="driver" id="filter-driver" class="form-control">
                    <option value="all">All</option>
                    @foreach (var unit in ViewBag.crLogDriverList as List<JobsV1.Areas.Personel.Models.crLogDriver>)
                    {
                        <option value="@unit.Name"> @unit.Name </option>
                    }
                </select>
            </div>

            <div class="form-group" style="padding-right:5px;">
                <label for="filter-company">Company:</label>
                <select name="company" id="filter-company" class="form-control" style="width:120px;">
                    <option value="all">All</option>
                    @foreach (var unit in ViewBag.crLogCompanyList as List<JobsV1.Areas.Personel.Models.crLogCompany>)
                    {
                        <option value="@unit.Name"> @unit.Name </option>
                    }
                </select>
            </div>

            <div class="form-group" style="padding-right:5px;">
                <label for="sort-by">Sort:</label>
                <select name="sortby" id="sort-by" class="form-control" >
                    <option value="Unit"> Unit </option>
                    <option value="Company"> Company </option>
                    <option value="Driver"> Driver </option>
                    <option value="Date"> Date </option>
                </select>
            </div>

            <div class="form-group">
                <button class="btn btn-default"> Search </button>
            </div>
        }
    </form>
</div>

<table class="table">
    <tr>
        <th>
            Date
        </th>
        <th>
            Driver
        </th>
        <th>
            Description
        </th>
        <th>
            Rate
        </th>
        <th>
            Addon
        </th>
        <th>
            Expense
        </th>
        <th>
            Driver
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
<tr>
    <td>
        @Html.DisplayFor(modelItem => item.DtTrip)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.crLogDriver.Name)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.crLogUnit.Description)
        /
        @Html.DisplayFor(modelItem => item.crLogCompany.Name)
        /
        @Html.DisplayFor(modelItem => item.Remarks)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.Rate)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.Addon)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.Expenses)
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.DriverFee)
    </td>
    <td>
        @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
        @Html.ActionLink("Driver Summary", "DriverSummary", new { id = item.crLogDriverId })
    </td>
</tr>
    }

</table>

@section Scripts{
    <script src="~/Areas/Personel/Script/CarRentalLog.js"> </script>
    <script>
        $(document).ready(() => {
            $("#filter-unit").val("@ViewBag.FilteredUnit")
            $("#filter-driver").val("@ViewBag.FilteredDriver")
            $("#filter-company").val("@ViewBag.FilteredCompany")
            $("#sort-by").val("@ViewBag.SortBy")

            if ("@ViewBag.FilteredsDate" != "") {
                $("#filter-sdate").val(moment("@ViewBag.FilteredsDate").format("MM/DD/YYYY"))
            } else {
                $("#filter-sdate").val(moment().format("MM/DD/YYYY"))
            }

            if ("@ViewBag.FilteredsDate" != "") {
                $("#filter-edate").val(moment("@ViewBag.FilteredeDate").format("MM/DD/YYYY"))
            } else {
                $("#filter-edate").val(moment().format("MM/DD/YYYY"))
            }
        });

        function SetStartDate(days) {
            let sDate = moment().format("MM/DD/YYYY");
            $("#filter-sdate").val(moment(sDate).add(days, 'days').format("MM/DD/YYYY"));
        }
    </script>
    }