@model JobsV1.Models.ReportingViewModels.JobSummaryDetails
@{
    ViewBag.Title = "Job Summary Details";
    Layout = "~/Views/Shared/_ModuleLayout.cshtml";

    decimal Triplog_Rate = 0;
    decimal Triplog_Driver = 0;
    decimal Triplog_DriverOT = 0;
    decimal Triplog_DriverRate = 0;

    decimal Expenses_Amount = 0;
    decimal Expenses_Payment = 0;


    decimal Receivables_Amount = 0;
    decimal Receivables_Payment = 0;
    decimal Receivables_Deposit = 0;
}

<h2>Job Summary Details</h2>
<p>
    @Html.ActionLink("Back to List", "JobSummary") |
    @Html.ActionLink("Job Details", "JobServices", "JobOrder",new { jobMainId = Model.Id }, null)
</p>

<h4>
    Job#:
    <a href="/JobOrder/JobServices?JobMainId=@Model.Id">@Model.Id</a>
</h4>
<h4> Account: @Model.Account </h4>
<h4> STATUS: @Model.Status </h4>
<h3> Amount: <b>@Model.Amount.ToString("#,##0.00")</b></h3>
<hr />


<h4> Triplogs </h4>
<table class="table">
    <tr>
        <th>
            #
        </th>
        <th>
            Date
        </th>
        <th>
            Description
        </th>
        <th>
            Driver
        </th>
        <th>
            Drivers
        </th>
        <th>
            OT
        </th>
    </tr>

    @foreach (var trip in Model.TripLogs)
    {

        Triplog_Rate += trip.Rate + trip.Addon;
        Triplog_Driver += trip.DriverFee + trip.DriverOT;
        Triplog_DriverRate += trip.DriverFee;
        Triplog_DriverOT += trip.DriverOT;

        <tr>
            <td>
                <a href="/Personel/CarRentalLog/Details/@trip.Id">@trip.Id</a>
            </td>
            <td>
                @trip.DtTrip.ToString("MMM dd yyyy")
            </td>
            <td>
                @trip.crLogUnit.Description (@trip.crLogUnit.crLogOwner.Name)
            </td>
            <td>
                @trip.crLogDriver.Name
            </td>
            <td>
                @trip.DriverFee.ToString("#,##0.00")
            </td>
            <td>
                @trip.DriverOT.ToString("#,##0.00")
            </td>

        </tr>
    }
    <tr>
        <td colspan="4">
        </td>
        <td>
            @Triplog_DriverRate.ToString("#,##0.00")
        </td>
        <td>
            @Triplog_DriverOT.ToString("#,##0.00")
        </td>
    </tr>
    <tr>
        <td colspan="4">
        </td>
        <td colspan="2">

            Total <br />
            <b>
                @Triplog_Driver.ToString("#,##0.00")
            </b>
        </td>
    </tr>
</table>

<hr />

<h4> Expenses </h4>
<table class="table">
    <tr>
        <th>#</th>
        <th>
            Date
        </th>
        <th>
            Description
        </th>
        <th>
            Status
        </th>
        <th>
            Type
        </th>
        <th>
            Amount
        </th>
    </tr>

    @foreach (var expense in Model.Expenses)
    {
        if (expense.ApTransStatu.Status == "Returned" || expense.ApTransStatu.Status == "Closed")
        {
            Expenses_Amount += expense.Amount;
            Expenses_Payment += expense.ApTransPayments.Sum(c => c.ApPayment.Amount);
        }

        <tr>
            <td>
                <a href="/Payables/ApTransactions/Details/@expense.Id">@expense.Id</a>
            </td>
            <td>
                @expense.DtInvoice.ToString("MMM dd yyyy")
            </td>
            <td>
                @expense.Description
            </td>
            <td>
                @expense.ApTransStatu.Status
            </td>
            <td>
                @expense.ApTransType.Type
            </td>
            <td>
                @if (expense.ApTransStatu.Status == "Returned" || expense.ApTransStatu.Status == "Closed")
                {
                    @expense.Amount.ToString("#,##0.00")
                }
                else
                {
                    <span>0.00</span>
                }

            </td>
        </tr>
    }
    <tr>
        <td colspan="5">
        </td>
        <td>
            Total <br />
            <b>
                @Expenses_Amount.ToString("#,##0.00")
            </b>
        </td>
    </tr>
</table>

<hr />

<h4> Receivables </h4>
<table class="table">
    <tr>
        <th>
            #
        </th>
        <th>
            Date
        </th>
        <th>
            Description
        </th>
        <th>
            Status
        </th>
        <th>
            Amount
        </th>
        <th>
            Collected
        </th>
        <th>
            Deposited
        </th>
    </tr>

    @foreach (var receivables in Model.Receivables)
    {
        Receivables_Amount += receivables.Amount;
        Receivables_Payment += receivables.ArTransPayments.Sum(c => c.ArPayment.Amount);
        Receivables_Deposit += receivables.ArTransDeposits.Sum(c => c.ArDeposit.Amount);
        <tr>
            <td>
                <a href="/Receivables/ArTransactions/Details/@receivables.Id"> @receivables.Id</a>
            </td>
            <td>
                @receivables.DtInvoice.ToString("MMM dd yyyy")
            </td>
            <td>
                @receivables.Description
            </td>
            <td>
                @receivables.ArTransStatu.Status
            </td>
            <td>
                @receivables.Amount.ToString("#,##0.00")
            </td>
            <td>
                @receivables.ArTransPayments.Sum(c => c.ArPayment.Amount).ToString("#,##0.00")
            </td>
            <td>
                @receivables.ArTransDeposits.Sum(c => c.ArDeposit.Amount).ToString("#,##0.00")
            </td>
        </tr>
    }
    <tr>
        <td colspan="5">
        </td>
        <td>
            Payment <br />
            <b>@Receivables_Payment.ToString("#,##0.00")</b>
        </td>
        <td>
            Deposited <br />
            <b>@Receivables_Deposit.ToString("#,##0.00")</b>
        </td>
    </tr>
</table>

<hr />

<div style="padding:25px;background-color:#e8e8e8;">
    <h2> Summary </h2>
    <h3> Invoice Amount: <b>@Model.Amount.ToString("#,##0.00")</b></h3>
    <h3> Collected Amount:  <b>@Receivables_Payment.ToString("#,##0.00")</b></h3>
    <h3> Expense Amount:  <b>@Expenses_Amount.ToString("#,##0.00")</b></h3>
    <h3> Drivers Amount:  <b>@Triplog_Driver.ToString("#,##0.00")</b></h3>
</div>