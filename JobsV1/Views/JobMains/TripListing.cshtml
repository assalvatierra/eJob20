@model IEnumerable<JobsV1.Models.TripListing>

@{
    ViewBag.Title = "Trip Listing";
    Layout = "~/Views/Shared/_ModuleLayout.cshtml";
}

<h2>Trip Listing</h2>

<div class="col-sm-8">
        @Html.ActionLink("30 Days", "TripListing", new { DateRange = 30 }) | 
        @Html.ActionLink("7 Days", "TripListing", new { DateRange = 7 })
</div>

<div class="col-sm-6 btn-group" id="itemSelected" style="margin-bottom:10px;">
    <input id="srch-field" class="input-group-sm form-control col-sm-4" style="margin-top:5px;border-radius:0px;width:150px;" placeholder="Search" />
    <button class="btn btn-default col-sm-3" onclick="search();"> Search </button>
</div>

<br />
<table class="table">
    <tr>
        <th>
            Date
        </th>
        <th>
            Job Id.
        </th>
        <th style="min-width:230px;">
            Car 
        </th>
        <th>
            Driver
        </th>
        <th>
            Particulars / Job Name
        </th>
        <th>
            Amount
        </th>
        <th>
            Payment
        </th>
        <th>
            Fuel
        </th>
        <th>
            Driver
        </th>
        <th>
            Operator 
        </th>
        <th></th>
    </tr>
@{
    var tempdate = "";
    var jobList = new List<int>();
    }



@foreach (var item in Model) {

    if (!jobList.Contains(item.JobServicesId))
    {
        jobList.Add(item.JobServicesId);

        if (tempdate == item.DtService.ToShortDateString())
        {
            <tr>
                <td>
            
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.JobMainId) 
                </td>
                <td>
                   @foreach (var unitItem in item.Unit)
                   {
                       @unitItem <br />
                   }
                </td>
                <td>
                    @foreach (var driverItem in item.Driver)
                    {
                        @driverItem <br />
                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Particulars) / @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    @Decimal.Parse(item.ActualAmt.ToString()).ToString("N0")
                </td>
                <td>
                    @Decimal.Parse(item.Payment.ToString()).ToString("N0")
                </td>
                <td>
                    @Decimal.Parse(item.Fuel.ToString()).ToString("N0")
                </td>
                <td>
                    @Decimal.Parse(item.DriverComi.ToString()).ToString("N0")
                </td>
                <td>
                    @Decimal.Parse(item.OperatorComi.ToString()).ToString("N0")
                </td>
                <td>                
                    @Html.ActionLink("Details", "JobServices", "JobOrder", new { JobMainId = item.JobMainId }, null) |
                    <a id="catbtn" data-toggle="modal" data-target="#AddExpenses"
                       style="margin-bottom:10px;" onclick="addExpenses('@item.JobServicesId')">Expenses</a>
                </td>
            </tr>
        }
        else
        {
            <tr>
                <td>
                    @item.DtService.ToString("MMM dd yyyy")
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.JobMainId)
                </td>
                <td>
                    @foreach (var unitItem in item.Unit)
                    {
                        @unitItem <br />
                    }
                </td>
                <td>
                    @foreach (var driverItem in item.Driver)
                    {
                        @driverItem <br />
                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Particulars) / @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    @Decimal.Parse(item.ActualAmt.ToString()).ToString("N0")
                </td>
                <td>
                    @Decimal.Parse(item.Payment.ToString()).ToString("N0")
                </td>
                <td>
                    @Decimal.Parse(item.Fuel.ToString()).ToString("N0")
                </td>
                <td>
                    @Decimal.Parse(item.DriverComi.ToString()).ToString("N0")
                </td>
                <td>
                    @Decimal.Parse(item.OperatorComi.ToString()).ToString("N0")
                </td>
                <td> 
                    @Html.ActionLink("Details", "JobServices", "JobOrder", new { JobMainId = item.JobMainId }, null  ) |
                    <a id="catbtn" data-toggle="modal" data-target="#AddExpenses" class="cursor-hand"
                       style="margin-bottom:10px;" onclick="addExpenses('@item.JobServicesId')">Expenses</a>
                </td>
            </tr>

        }

    }
    else
    {
        if (tempdate == item.DtService.ToShortDateString())
        {
            <tr>
                <td></td>
                <td>
                    @Html.DisplayFor(modelItem => item.JobMainId)
                </td>
                <td>
                    @foreach (var unitItem in item.Unit)
                    {
                        @unitItem <br />
                    }
                </td>
                <td>
                    @foreach (var driverItem in item.Driver)
                    {
                        @driverItem <br />
                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Particulars) / @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                 -
                </td>
                <td>
                    -
                </td>
                <td>
                 -
                </td>
                <td>
                    -
                </td>
                <td>
                    -
                </td>
                <td>
                    @Html.ActionLink("Details", "JobServices", "JobOrder", new { JobMainId = item.JobMainId }, null) |
                    <a id="catbtn" data-toggle="modal" data-target="#AddExpenses"
                       style="margin-bottom:10px;" onclick="addExpenses('@item.JobServicesId')">Expenses</a>
                </td>
            </tr>
        }
        else
        {
            <tr>
                <td>
                    @item.DtService.ToString("MMM dd yyyy")
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.JobMainId)
                </td>
                <td>
                    @foreach (var unitItem in item.Unit)
                    {
                        @unitItem <br />
                    }
                </td>
                <td>
                    @foreach (var driverItem in item.Driver)
                    {
                        @driverItem <br />
                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Particulars) / @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    -
                </td>
                <td>
                    -
                </td>
                <td>
                    -
                </td>
                <td>
                    -
                </td>
                <td>
                    -
                </td>
                <td>
                    @Html.ActionLink("Details", "JobServices", "JobOrder", new { JobMainId = item.JobMainId }, null) |
                    <a id="catbtn" data-toggle="modal" data-target="#AddExpenses" class="cursor-hand"
                       style="margin-bottom:10px;" onclick="addExpenses('@item.JobServicesId')">Expenses</a>
                </td>
            </tr>
        }
    }

    tempdate = item.DtService.ToShortDateString();
}
</table>


<!--Modal-->
@{Html.RenderPartial("TripListing_Expenses", null, null );}

<script src="~/Scripts/jquery-3.3.1.js"> </script>
<script>
    var dateRange = 7;
            
    function search() {

        const urlParams = new URLSearchParams(window.location.search);
        const myParam = urlParams.get('DateRange');
        dateRange = myParam;
        var srch = $("#srch-field").val();
        //dateRange = 30;
        //srch = "Honda";
        window.location.replace("/JobMains/TripListing?DateRange="+ dateRange +"&srch="+srch);
    }

</script>